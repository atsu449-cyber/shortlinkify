# ローカル開発から本番公開までの完全マニュアル

本書は、今回（ShortLinkify）の開発を通じて得られた知見をもとに、次回以降のWebアプリケーション開発において「ローカルでの開発」から「本番環境（インターネット上）での公開」までをスムーズに行うための手順書です。

---

## 🛠️ 1. 使用するツール（構成要素）と料金概要

アプリケーションを開発し、本番環境で動かすために組み合わせる主要なサービスです。

### 1. Next.js / React (フロントエンド ＋ バックエンドの一部)
- **概要**: アプリの画面（UI）を作り、データベースとやり取りする処理を書くためのフレームワーク（プログラムの土台）。
- **料金**: 完全無料（オープンソース）。パソコン（ローカル環境）にインストールして使います。

### 2. Supabase (データベース ＋ ユーザー認証)
- **概要**: ユーザー情報（ログイン・パスワード）やデータを保存するクラウドデータベース。「BaaS（Backend as a Service）」と呼ばれるもので、自分でサーバーを立てる手間が省けます。
- **料金**: 最初の2プロジェクトまでは**無料枠（Freeプラン）**で利用可能。個人開発や小規模なアプリならこの枠で十分収まります。有料版は月額$25〜。

### 3. Vercel (ホスティング・デプロイ環境)
- **概要**: 完成したプログラム（Next.jsなどのコード）をインターネット上に公開（ホスティング）するためのサービス。コードを修正してGitHubにプッシュするだけで、全自動で本番環境の画面が更新されます。
- **料金**: 個人利用（Hobbyプラン）は**完全無料**。商用利用（チームでの開発など）の場合はProプラン（月額$20/ユーザー）が必要です。

### 4. GitHub (ソースコードの管理)
- **概要**: プログラムの設計図（ソースコード）を保存・共有するためのクラウドサービス。Vercelと連携させることで、「GitHubにコードを保存する ＝ アプリが公開される」という仕組みを作ります。
- **料金**: 基本機能は**無料**で利用可能。

### 5. Resend (メール配信サービス)
- **概要**: 「パスワードリセット」や「登録完了」などのシステムメールを送信するためのAPIサービス。
- **料金**: 月間3,000通まで（1日あたり100通まで）は**無料枠（Freeプラン）**で利用可能。独自ドメインからのメール送信（`noreply@yourdomain.com`など）に対応しています。

### 6. 独自ドメイン取得サービス (Porkbun, ムームードメインなど)
- **概要**: `slf.onl` のようなオリジナルのURL（ドメイン）を取得・管理するサービスです。
- **料金**: ドメインの種類（`.com`, `.jp`, `.onl` など）によりますが、**年間で数百円〜数千円**程度の維持費がかかります。（初期1年は安く、更新時に高くなるケースが多いので注意）。

---

## 🚀 2. 開発・公開フロー全体図

1. **[ローカル]** アプリの開発・テスト
2. **[Supabase]** データベースと認証（ログイン機能）の設定
3. **[GitHub]** 作成したプログラムコードをアップロード
4. **[Vercel]** GitHubと連携し、インターネット上に公開
5. **[Domain]** 独自ドメイン（URL）の紐付け設定
6. **[Resend]** パスワード再設定などのメール配信設定

各詳細については以下で手順を解説します。

---

## 📝 3. 各フローの詳細な画面操作手順

### ステップ1：Supabaseのプロジェクト作成と設定
アプリの裏側（データ保存先やログイン機能）を用意します。

1. [Supabase](https://supabase.com/) にアクセスし、GitHubアカウント等でログインして「**New Project**」をクリック。
2. 所属するOrganization（組織）を選択し、以下の情報を入力します。
   - **Name**: プロジェクト名（例: `my-next-app`）
   - **Database Password**: DBに接続するためのパスワード。超強力なものを自動生成し、必ずメモしておきます。（後で環境変数に使用）
   - **Region**: サーバーの場所。日本から使うなら「**Tokyo (ap-northeast-1)**」を選択。
3. 「**Create new project**」をクリック。数分待つとプロジェクトが作成されます。
4. **環境変数の取得**:
   - 左側メニューの歯車アイコン「**Project Settings**」をクリックし、さらに「**API**」タブをクリックします。
   - 画面に表示される `Project URL` と `Project API keys (anon / public)` をコピーしておきます。（これがないとアプリからDBに入れません）
5. **認証プロバイダの設定（メール認証）**:
   - 左側メニューの鍵アイコン「**Authentication**」を選択し、上部メニューの「**Providers**」をクリックします。
   - 「**Email**」を開き、「Enable Email provider」をONに、「Confirm email（登録確認メールの要否）」をプロジェクト仕様に合わせて設定して保存します。
6. **サイトURLの登録（リダイレクト対策）**:
   - 同じく Authentication の「**URL Configuration**」を開きます。
   - 「Site URL」にローカル環境のURL（例: `http://localhost:3000`）を入れます（後で本番URLも入れます）。

### ステップ2：ローカル環境（自分のPC）での開発
1. 必要に応じて `.env.local` という隠しファイルを作成し、Supabaseなどで取得した環境変数を貼り付けます。（絶対にこのファイルをGitHub上に公開してはいけません）
2. ターミナルで `npm run dev` と打ち込み、ブラウザで `localhost:3000` を開いて動作確認をしながら作ります。

### ステップ3：GitHubへのアップロード
ローカルで動くものが完成したら、それをクラウドに預けます。

1. [GitHub](https://github.com/) にログインし、右上の「+」ボタンから「**New repository**」を選択。
2. 「Repository name」を入力し、「Private」（非公開）または「Public」（公開）を選んで「Create repository」をクリック。
3. ローカルのターミナル（コマンド入力画面）で、表示された案内に従ってコマンドを実行し、ファイルをプッシュ（送信）します。

### ステップ4：Vercelでの本番デプロイ（公開）
GitHubにあるコードを読み取って、Webサイトとして表示させます。

1. [Vercel](https://vercel.com/) にログインし、「**Add New...**」→「**Project**」をクリック。
2. 画面左側に自分のGitHubリポジトリ一覧が表示されるので、先ほど作ったリポジトリの横の「**Import**」をクリック。
3. **環境変数（Environment Variables）の設定**（超重要）:
   - 「Environment Variables」という折りたたみメニューを開きます。
   - ローカルの `.env.local` に書いていたのと同じ値（URLやAPIキーなど）を、一つ一つ「Name」と「Value」に入力して「Add」を押していきます。
4. すべて準備できたら「**Deploy**」ボタンをクリック。数分待つとお祝いの画面が出現し、世界中にアプリが公開されます！ 🎉

### ステップ5：Vercelでの独自ドメイン設定
初期の `あなたのアプリ.vercel.app` ではなく、自分が買ったURLを紐付けます。

1. Vercelのダッシュボードで、デプロイしたプロジェクトを開き、上部のタブから「**Settings**」を選択。
2. 左メニューにある「**Domains**」を選択し、取得した独自ドメイン（例: `slf.onl`）を入力して「**Add**」をクリック。
3. ドメインを入力すると、Vercelの画面上に以下のようなDNS設定指示が表示されます。（推奨はAレコードとCNAMEを使う方法です）
   - **A Record**: Name `@` (または空欄), Value `76.76.21.21`
   - **CNAME Record**: Name `www`, Value `cname.vercel-dns.com.`
4. ドメインを取得したサイト（Porkbun等）にログインし、「DNS Settings（DNSレコード設定）」の画面を開きます。
5. **【重要：Porkbun等の場合】** 最初から登録されている不要なレコード（デフォルトのALIASやCNAMEなど）があると新しい設定と競合してエラーになるため、**先にそれらを削除（ごみ箱アイコン）**します。
6. Vercelで指定された通り、AレコードとCNAMEレコードをそれぞれ追加して保存します。
7. Vercelの画面に戻り、設定が正しく反映されると無効状態からブルーチェック（Valid）に変わります。（※反映に数分かかる場合があります）
8. **【忘れずに】** Supabaseの「Authentication」→「URL Configuration」に戻り、「*Site URL*」を独自ドメイン（`https://あなたのドメイン.com`）に変更します。

### ステップ6：Resendでの独自ドメインメール送信設定
「パスワードのリセットや登録確認メール」を確実に届ける（スパム扱いさせない）ため、専用のメールシステムを設定します。

1. [Resend](https://resend.com/) にログインし、左側メニューの「**API Keys**」を開き、「**Create API Key**」をクリックしてAPIキーを作成・コピーします。（一度しか表示されないので確実にメモを）
2. 左側メニューの「**Domains**」をクリックし、「**Add Domain**」ボタンを押します。
3. 自分が取得したドメイン（例: `slf.onl`）を入力して「Add」をクリック。
4. すると、DNSに設定すべき複数個のTXTレコードやMXレコード（SPF、DKIMなどと呼ばれる迷惑メール対策の設定）が表示されます。
5. 先ほどと同じようにドメイン取得サイト（Porkbun等）のDNS設定画面を開き、Resendで指示されたレコードを**「Type（種類）」「Host（名前）」「Value（値）」が一字一句間違えないよう**にすべて追加します。
6. すべて追加したらResendの画面一覧に戻り、「**Verify**」ボタンを押します。ステータスが緑色の「Verified」になればドメイン連携成功です。
7. **Supabase側のSMTP設定**を実施します。
   - Supabaseの左側メニュー下部「Project Settings」⚙️アイコン → 「Authentication」メニュー内を開き、スクロールして「**SMTP Settings**」の項目を探します。
   - 「Enable Custom SMTP」をONにし、以下のように連携情報を入力して保存します。
     - **Sender address**: `noreply@slf.onl` など (連携した独自ドメインのメアド)
     - **Sender name**: サービス名（ShortLinkify など）
     - **Host**: `smtp.resend.com`
     - **Port**: `465` (一部環境では587)
     - **User**: `resend` (※自分のメアドではなく固定の文字列「resend」を入力します。ここが罠になりやすいです)
     - **Password**: 先ほどResendで作成したAPIキー（`re_...` から始まる長い文字列）
8. 最後に、Supabaseの「**Email Templates**」設定から、各案内メールに記載されているリンクURLの先頭を `{{ .SiteURL }}` （設定した独自ドメインに変換するマジックワード）となるように編集すれば完了です。

---

> 💡 **今後の開発に向けたアドバイス**
> 
> 初めてのWebアプリ公開、数々の壁がありながらの到達、本当にお疲れ様でした！初めての際は「DNSレコードって何？」といった用語の壁や、サービスごとに画面を行き来する回数の多さに圧倒されがちです。
> しかし、1度この一連のパイプライン（ローカル→GitHub→Vercel→ドメイン）を構築してしまえば、2回目からは数分で終わるようになります。
> 次回のサービス開発時には、ぜひこのマニュアルを横に置いて、落ち着いて設定を進めてみてください！

---

### ステップ7：ソースコード修正後の本番反映（プッシュ漏れ防止）
リリース後や開発終盤に「ローカルPC上でコードを直して満足し、本番環境に反映されていない」という人的ミス（プッシュ漏れ）が多発します。
ファイルを1行でも修正した場合は、**必ず以下の3つのコマンドを実行してVercelのオートデプロイを走らせる**ことをセットの習慣としてください。

1. ローカルのターミナルで変更をすべてステージングする：
   `git add .`
2. 変更内容に名前（コミットメッセージ）をつける：
   `git commit -m "fix: バグ修正やアップデート内容"`
3. GitHubへ送信（プッシュ）する：
   `git push`

※プッシュ完了後、Vercelダッシュボードの「Deployments」タブを開き、ビルドが成功（Ready）になり本番URLにアクセスして実際の画面が変わっていることを**視認するまでを1つのタスク**と見なします。
